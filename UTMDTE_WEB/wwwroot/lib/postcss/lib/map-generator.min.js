/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/postcss@8.4.12/lib/map-generator.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";let{SourceMapConsumer:SourceMapConsumer,SourceMapGenerator:SourceMapGenerator}=require("source-map-js"),{dirname:dirname,resolve:resolve,relative:relative,sep:sep}=require("path"),{pathToFileURL:pathToFileURL}=require("url"),Input=require("./input"),sourceMapAvailable=Boolean(SourceMapConsumer&&SourceMapGenerator),pathAvailable=Boolean(dirname&&resolve&&relative&&sep);class MapGenerator{constructor(t,e,s,i){this.stringify=t,this.mapOpts=s.map||{},this.root=e,this.opts=s,this.css=i}isMap(){return void 0!==this.opts.map?!!this.opts.map:this.previous().length>0}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk((t=>{if(t.source&&t.source.input.map){let e=t.source.input.map;this.previousMaps.includes(e)||this.previousMaps.push(e)}}));else{let t=new Input(this.css,this.opts);t.map&&this.previousMaps.push(t.map)}return this.previousMaps}isInline(){if(void 0!==this.mapOpts.inline)return this.mapOpts.inline;let t=this.mapOpts.annotation;return(void 0===t||!0===t)&&(!this.previous().length||this.previous().some((t=>t.inline)))}isSourcesContent(){return void 0!==this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:!this.previous().length||this.previous().some((t=>t.withContent()))}clearAnnotation(){if(!1!==this.mapOpts.annotation)if(this.root){let t;for(let e=this.root.nodes.length-1;e>=0;e--)t=this.root.nodes[e],"comment"===t.type&&0===t.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(e)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}setSourcesContent(){let t={};if(this.root)this.root.walk((e=>{if(e.source){let s=e.source.input.from;s&&!t[s]&&(t[s]=!0,this.map.setSourceContent(this.toUrl(this.path(s)),e.source.input.css))}}));else if(this.css){let t=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(t,this.css)}}applyPrevMaps(){for(let t of this.previous()){let e,s=this.toUrl(this.path(t.file)),i=t.root||dirname(t.file);!1===this.mapOpts.sourcesContent?(e=new SourceMapConsumer(t.text),e.sourcesContent&&(e.sourcesContent=e.sourcesContent.map((()=>null)))):e=t.consumer(),this.map.applySourceMap(e,s,this.toUrl(this.path(i)))}}isAnnotation(){return!!this.isInline()||(void 0!==this.mapOpts.annotation?this.mapOpts.annotation:!this.previous().length||this.previous().some((t=>t.annotation)))}toBase64(t){return Buffer?Buffer.from(t).toString("base64"):window.btoa(unescape(encodeURIComponent(t)))}addAnnotation(){let t;t=this.isInline()?"data:application/json;base64,"+this.toBase64(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:"function"==typeof this.mapOpts.annotation?this.mapOpts.annotation(this.opts.to,this.root):this.outputFile()+".map";let e="\n";this.css.includes("\r\n")&&(e="\r\n"),this.css+=e+"/*# sourceMappingURL="+t+" */"}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}generateMap(){if(this.root)this.generateString();else if(1===this.previous().length){let t=this.previous()[0].consumer();t.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(t)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>",generated:{line:1,column:0},original:{line:1,column:0}});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}path(t){if(0===t.indexOf("<"))return t;if(/^\w+:\/\//.test(t))return t;if(this.mapOpts.absolute)return t;let e=this.opts.to?dirname(this.opts.to):".";return"string"==typeof this.mapOpts.annotation&&(e=dirname(resolve(e,this.mapOpts.annotation))),t=relative(e,t)}toUrl(t){return"\\"===sep&&(t=t.replace(/\\/g,"/")),encodeURI(t).replace(/[#?]/g,encodeURIComponent)}sourcePath(t){if(this.mapOpts.from)return this.toUrl(this.mapOpts.from);if(this.mapOpts.absolute){if(pathToFileURL)return pathToFileURL(t.source.input.from).toString();throw new Error("`map.absolute` option is not available in this PostCSS build")}return this.toUrl(this.path(t.source.input.from))}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let t,e,s=1,i=1,o="<no source>",n={source:"",generated:{line:0,column:0},original:{line:0,column:0}};this.stringify(this.root,((r,a,p)=>{if(this.css+=r,a&&"end"!==p&&(n.generated.line=s,n.generated.column=i-1,a.source&&a.source.start?(n.source=this.sourcePath(a),n.original.line=a.source.start.line,n.original.column=a.source.start.column-1,this.map.addMapping(n)):(n.source=o,n.original.line=1,n.original.column=0,this.map.addMapping(n))),t=r.match(/\n/g),t?(s+=t.length,e=r.lastIndexOf("\n"),i=r.length-e):i+=r.length,a&&"start"!==p){let t=a.parent||{raws:{}};("decl"!==a.type||a!==t.last||t.raws.semicolon)&&(a.source&&a.source.end?(n.source=this.sourcePath(a),n.original.line=a.source.end.line,n.original.column=a.source.end.column-1,n.generated.line=s,n.generated.column=i-2,this.map.addMapping(n)):(n.source=o,n.original.line=1,n.original.column=0,n.generated.line=s,n.generated.column=i-1,this.map.addMapping(n)))}}))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let t="";return this.stringify(this.root,(e=>{t+=e})),[t]}}}module.exports=MapGenerator;
//# sourceMappingURL=/sm/e77f98b657cc82db19a6b3f78874c7c26f0fb22bf94f8ff637b7aa087695a255.map
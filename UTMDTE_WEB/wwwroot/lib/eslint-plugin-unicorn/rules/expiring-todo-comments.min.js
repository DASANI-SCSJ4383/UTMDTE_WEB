/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/eslint-plugin-unicorn@41.0.1/rules/expiring-todo-comments.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";const readPkgUp=require("read-pkg-up"),semver=require("semver"),ci=require("ci-info"),getBuiltinRule=require("./utils/get-builtin-rule.js"),baseRule=getBuiltinRule("no-warning-comments"),MESSAGE_ID_AVOID_MULTIPLE_DATES="unicorn/avoidMultipleDates",MESSAGE_ID_EXPIRED_TODO="unicorn/expiredTodo",MESSAGE_ID_AVOID_MULTIPLE_PACKAGE_VERSIONS="unicorn/avoidMultiplePackageVersions",MESSAGE_ID_REACHED_PACKAGE_VERSION="unicorn/reachedPackageVersion",MESSAGE_ID_HAVE_PACKAGE="unicorn/havePackage",MESSAGE_ID_DONT_HAVE_PACKAGE="unicorn/dontHavePackage",MESSAGE_ID_VERSION_MATCHES="unicorn/versionMatches",MESSAGE_ID_ENGINE_MATCHES="unicorn/engineMatches",MESSAGE_ID_REMOVE_WHITESPACE="unicorn/removeWhitespaces",MESSAGE_ID_MISSING_AT_SYMBOL="unicorn/missingAtSymbol",MESSAGE_ID_CORE_RULE_UNEXPECTED_COMMENT="unexpectedComment",messages={"unicorn/avoidMultipleDates":"Avoid using multiple expiration dates in TODO: {{expirationDates}}. {{message}}","unicorn/expiredTodo":"There is a TODO that is past due date: {{expirationDate}}. {{message}}","unicorn/reachedPackageVersion":"There is a TODO that is past due package version: {{comparison}}. {{message}}","unicorn/avoidMultiplePackageVersions":"Avoid using multiple package versions in TODO: {{versions}}. {{message}}","unicorn/havePackage":"There is a TODO that is deprecated since you installed: {{package}}. {{message}}","unicorn/dontHavePackage":"There is a TODO that is deprecated since you uninstalled: {{package}}. {{message}}","unicorn/versionMatches":"There is a TODO match for package version: {{comparison}}. {{message}}","unicorn/engineMatches":"There is a TODO match for Node.js version: {{comparison}}. {{message}}","unicorn/removeWhitespaces":"Avoid using whitespace on TODO argument. On '{{original}}' use '{{fix}}'. {{message}}","unicorn/missingAtSymbol":"Missing '@' on TODO argument. On '{{original}}' use '{{fix}}'. {{message}}",...baseRule.meta.messages,unexpectedComment:"Unexpected '{{matchedTerm}}' comment without any conditions: '{{comment}}'."},packageResult=readPkgUp.sync(),hasPackage=Boolean(packageResult),packageJson=hasPackage?packageResult.packageJson:{},packageDependencies={...packageJson.dependencies,...packageJson.devDependencies},DEPENDENCY_INCLUSION_RE=/^[+-]\s*@?\S+\/?\S+/,VERSION_COMPARISON_RE=/^(?<name>@?\S\/?\S+)@(?<condition>>|>=)(?<version>\d+(?:\.\d+){0,2}(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?)/i,PKG_VERSION_RE=/^(?<condition>>|>=)(?<version>\d+(?:\.\d+){0,2}(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?)\s*$/,ISO8601_DATE=/\d{4}-\d{2}-\d{2}/;function parseTodoWithArguments(e,{terms:n}){const o=e.toLowerCase();if(!n.map((e=>e.toLowerCase())).some((e=>o.includes(e))))return!1;const s=/\[(?<rawArguments>[^}]+)]/i.exec(e);if(!s)return!1;const{rawArguments:a}=s.groups;return createArgumentGroup(a.split(",").map((e=>parseArgument(e.trim()))))}function createArgumentGroup(e){const n={};for(const{value:o,type:s}of e)n[s]=n[s]||[],n[s].push(o);return n}function parseArgument(e){if(ISO8601_DATE.test(e))return{type:"dates",value:e};if(hasPackage&&DEPENDENCY_INCLUSION_RE.test(e)){const n="+"===e[0]?"in":"out";return{type:"dependencies",value:{name:e.slice(1).trim(),condition:n}}}if(hasPackage&&VERSION_COMPARISON_RE.test(e)){const{groups:n}=VERSION_COMPARISON_RE.exec(e),o=n.name.trim(),s=n.condition.trim(),a=n.version.trim(),t=0===o.indexOf("engine:"),i=t&&"engine:node"===o;if(t&&i)return{type:"engines",value:{condition:s,version:a}};if(!t)return{type:"dependencies",value:{name:o,condition:s,version:a}}}if(hasPackage&&PKG_VERSION_RE.test(e)){const n=PKG_VERSION_RE.exec(e),{condition:o,version:s}=n.groups;return{type:"packageVersions",value:{condition:o.trim(),version:s.trim()}}}return{type:"unknowns",value:e}}function parseTodoMessage(e){const n=e.indexOf("]"),o=e.slice(n+1).trim();return":"===o[0]?o.slice(1).trim():o}function reachedDate(e,n){return Date.parse(e)<Date.parse(n)}function tryToCoerceVersion(e){if(!e)return!1;let n=String(e);const o=[">=","<=",">","<","~","^"].find((e=>n.startsWith(e)));o&&(n=n.slice(o.length));const s=n.split(" ");if(s.length>1&&(n=s[0]),semver.valid(n))return n;try{return semver.parse(n)||semver.coerce(n)}catch{return!1}}function semverComparisonForOperator(e){return{">":semver.gt,">=":semver.gte}[e]}const create=e=>{const n={terms:["todo","fixme","xxx"],ignore:[],ignoreDatesOnPullRequests:!0,allowWarningComments:!0,date:(new Date).toISOString().slice(0,10),...e.options[0]},o=n.ignore.map((e=>e instanceof RegExp?e:new RegExp(e,"u"))),s=e.getSourceCode(),a=s.getAllComments().filter((e=>"Shebang"!==e.type)).flatMap((e=>e.value.split("\n").map((n=>({...e,value:n}))))).filter((s=>function(s){if(o.some((e=>e.test(s.value))))return;const a=parseTodoWithArguments(s.value,n);if(!a)return!0;let t=0;const{packageVersions:i=[],dates:r=[],dependencies:c=[],engines:u=[],unknowns:g=[]}=a;if(r.length>1)t++,e.report({loc:s.loc,messageId:"unicorn/avoidMultipleDates",data:{expirationDates:r.join(", "),message:parseTodoMessage(s.value)}});else if(1===r.length){t++;const[o]=r;!(n.ignoreDatesOnPullRequests&&ci.isPR)&&reachedDate(o,n.date)&&e.report({loc:s.loc,messageId:"unicorn/expiredTodo",data:{expirationDate:o,message:parseTodoMessage(s.value)}})}if(i.length>1)t++,e.report({loc:s.loc,messageId:"unicorn/avoidMultiplePackageVersions",data:{versions:i.map((({condition:e,version:n})=>`${e}${n}`)).join(", "),message:parseTodoMessage(s.value)}});else if(1===i.length){t++;const[{condition:n,version:o}]=i,a=tryToCoerceVersion(packageJson.version),r=tryToCoerceVersion(o),c=semverComparisonForOperator(n);a&&c(a,r)&&e.report({loc:s.loc,messageId:"unicorn/reachedPackageVersion",data:{comparison:`${n}${o}`,message:parseTodoMessage(s.value)}})}for(const n of c){t++;const o=packageDependencies[n.name],a=Boolean(o);if(["in","out"].includes(n.condition)){const[o,t]="in"===n.condition?[a,"unicorn/havePackage"]:[!a,"unicorn/dontHavePackage"];o&&e.report({loc:s.loc,messageId:t,data:{package:n.name,message:parseTodoMessage(s.value)}});continue}const i=tryToCoerceVersion(n.version),r=tryToCoerceVersion(o);if(!a||!r)continue;semverComparisonForOperator(n.condition)(r,i)&&e.report({loc:s.loc,messageId:"unicorn/versionMatches",data:{comparison:`${n.name} ${n.condition} ${n.version}`,message:parseTodoMessage(s.value)}})}const d=packageJson.engines||{};for(const n of u){t++;const o=d.node;if(!Boolean(o))continue;const a=tryToCoerceVersion(n.version),i=tryToCoerceVersion(o);semverComparisonForOperator(n.condition)(i,a)&&e.report({loc:s.loc,messageId:"unicorn/engineMatches",data:{comparison:`node${n.condition}${n.version}`,message:parseTodoMessage(s.value)}})}for(const n of g){const o=n.includes("@"),a=n.indexOf(">");if(!o&&-1!==a){const o=`${n.slice(0,a)}@${n.slice(a)}`;if("unknowns"!==parseArgument(o).type){t++,e.report({loc:s.loc,messageId:"unicorn/missingAtSymbol",data:{original:n,fix:o,message:parseTodoMessage(s.value)}});continue}}const i=n.replace(/ /g,"");"unknowns"===parseArgument(i).type||(t++,e.report({loc:s.loc,messageId:"unicorn/removeWhitespaces",data:{original:n,fix:i,message:parseTodoMessage(s.value)}}))}return 0===t}(s))),t={...e,getSourceCode:()=>({...s,getAllComments:()=>n.allowWarningComments?[]:a})},i=baseRule.create(t);return{Program(){i.Program()}}},schema=[{type:"object",additionalProperties:!1,properties:{terms:{type:"array",items:{type:"string"}},ignore:{type:"array",uniqueItems:!0},ignoreDatesOnPullRequests:{type:"boolean",default:!0},allowWarningComments:{type:"boolean",default:!1},date:{type:"string",format:"date"}}}];module.exports={create:create,meta:{type:"suggestion",docs:{description:"Add expiration conditions to TODO comments."},schema:schema,messages:messages}};
//# sourceMappingURL=/sm/5115d2a6130d19009b41efb316650f437c1a60513067c5ed6880efd186f48913.map
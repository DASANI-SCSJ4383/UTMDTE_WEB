/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/browser-sync@2.27.9/dist/connect-utils.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var _=require("./lodash.custom"),fs=require("fs"),config=require("./config");function getPath(t,e,n){return"snippet"===t.get("mode")?t.get("scheme")+"://HOST:"+n+e:"//HOST:"+n+e}var connectUtils={enabled:function(t){const e=t.get("snippet");return"boolean"!=typeof e||e},scriptTags:function(t){var e=this.clientScript(t),n=t.getIn(["snippetOptions","async"]),o=t.getIn(["script","domain"]),r=t.get("localOnly")?[t.get("scheme"),"://localhost:",t.get("port"),e].join(""):_.isFunction(t.get("scriptPath"))?t.get("scriptPath").apply(null,getScriptArgs(t,e)):o?_.isFunction(o)?o.call(null,t)+e:o.match(/\{port\}/)?o.replace("{port}",t.get("port"))+e:o+e:t.get("server")||t.get("proxy")?e:getPath(t,e,t.get("port")),c=o||t.get("localOnly")?config.templates.scriptTagSimple:config.templates.scriptTag;return fs.readFileSync(c,"utf8").replace("%script%",r).replace("%async%",n?"async":"")},socketConnector:function(t){var e=t.get("socket"),n=fs.readFileSync(config.templates.connector,"utf-8"),o=connectUtils.getConnectionUrl(t),r=e.get("socketIoClientConfig").merge({path:e.get("path")});return n=n.replace("%config%",JSON.stringify(r.toJS())).replace("%options%",JSON.stringify(t)).replace("%url%",o)},getNamespace:function(t,e){var n=t.namespace;return"function"==typeof n?n(e):(n.match(/^\//)||(n="/"+n),n)},getConnectionUrl:function(t){var e=t.get("socket").toJS(),n=connectUtils.getNamespace(e,t),o="",r="'{domain}{ns}'",c=t.get("port"),i="'{protocol}' + location.host + '{ns}'";return"server"!==t.get("mode")&&(o=t.get("scheme")+"://",i="'{protocol}' + location.hostname + ':{port}{ns}'"),"proxy"===t.get("mode")&&t.getIn(["proxy","ws"])&&(c=t.getIn(["socket","port"])),e.domain=function(){if(t.get("localOnly"))return i=r,[t.get("scheme"),"://localhost:",t.get("port")].join("");if(e.domain){if(i=r,_.isFunction(e.domain))return e.domain.call(null,t);if(_.isString(e.domain))return e.domain}return""}(),i.replace("{protocol}",o).replace("{port}",c).replace("{domain}",e.domain.replace("{port}",c)).replace("{ns}",n)},clientScript:function(t,e){var n=t.getIn(["socket","clientPath"]),o=n+"/browser-sync-client.js",r=n+"/browser-sync-client.js?v="+t.get("version");return e?{path:o,versioned:r}:r}};function getScriptArgs(t,e){var n=t.get("scheme")+"://HOST:"+t.get("port")+e;return[e,t.get("port"),t.set("absolute",n)]}module.exports=connectUtils;
//# sourceMappingURL=/sm/155c6dd708fd41fe91a4b18c9636d0a7a601769f0eaba0695f155955cb1aed1c.map
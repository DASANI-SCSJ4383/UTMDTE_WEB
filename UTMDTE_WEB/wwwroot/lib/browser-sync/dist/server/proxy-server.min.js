/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/browser-sync@2.27.9/dist/server/proxy-server.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var httpProxy=require("http-proxy"),utils=require("./utils"),proxyUtils=require("./proxy-utils"),Immutable=require("immutable"),Map=require("immutable").Map,List=require("immutable").List,defaultHttpProxyOptions=Map({changeOrigin:!0,autoRewrite:!0,secure:!1,ws:!0}),defaultCookieOptions=Map({stripDomain:!0}),ProxyOption=Immutable.Record({route:"",target:"",rewriteRules:!0,proxyReq:List([]),proxyRes:List([]),proxyReqWs:List([]),errHandler:void 0,url:Map({}),proxyOptions:Map(defaultHttpProxyOptions),cookies:Map(defaultCookieOptions),ws:!1,middleware:List([]),reqHeaders:void 0});function getProxyResFunctions(e,t){return t.getIn(["cookies","stripDomain"])?e.push(proxyUtils.checkCookies):e}function getProxyReqFunctions(e,t,r){var o=t.getIn(["reqHeaders"]);if(!o)return e;if("function"==typeof o){var i=o.call(r,t.toJS());if(Object.keys(i).length)return e.concat((function(e){Object.keys(i).forEach((function(t){e.setHeader(t,i[t])}))}))}return Map.isMap(o)?e.concat((function(e){o.forEach((function(t,r){e.setHeader(r,t)}))})):e}module.exports=function(e){var t=(new ProxyOption).mergeDeep(e.options.get("proxy")),r=httpProxy.createProxyServer(t.get("proxyOptions").set("target",t.get("target")).toJS()),o=t.get("target"),i=getProxyReqFunctions(t.get("proxyReq"),t,e),n=getProxyResFunctions(t.get("proxyRes"),t),s=t.get("proxyReqWs");e.options=e.options.update("middleware",(function(e){return e.concat({id:"Browsersync Proxy",route:t.get("route"),handle:function(e,t){r.web(e,t,{target:o})}})}));var u=utils.getBaseApp(e),p=utils.getServer(u,e.options);function a(e,t){List.isList(t)||(t=[t]),r.on(e,(function(){var e=arguments;t.forEach((function(t){"function"==typeof t&&t.apply(null,e)}))}))}return p.proxy=r,t.get("ws")&&p.server.on("upgrade",(function(e,t,o){r.ws(e,t,o)})),a("proxyReq",i),a("proxyRes",n),a("proxyReqWs",s),r.on("error",(function(e){"function"==typeof t.get("errHandler")&&t.get("errHandler").call(null,e)})),p};
//# sourceMappingURL=/sm/0bb61ba90660e79bb661b6c780c233d97dfecd2e9a39d52e6a7e7c0f160de62a.map
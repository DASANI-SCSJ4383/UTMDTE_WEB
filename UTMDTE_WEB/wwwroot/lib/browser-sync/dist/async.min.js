/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/browser-sync@2.27.9/dist/async.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var _=require("./lodash.custom"),Immutable=require("immutable"),utils=require("./utils"),pluginUtils=require("./plugins"),connectUtils=require("./connect-utils");module.exports={getEmptyPort:function(n,e){utils.getPorts(n.options,(function(t,i){if(t)return utils.fail(!0,t,n.cb);n.debug("Found a free port: {magenta:%s",i),e(null,{options:{port:i}})}))},getExtraPortForProxy:function(n,e){if("proxy"!==n.options.get("mode"))return e();if(!n.options.getIn(["proxy","ws"]))return e();var t=n.options.get("port")+1;n.options.hasIn(["socket","port"])&&(t=n.options.getIn(["socket","port"])),utils.getPort(n.options.get("listen","localhost"),t,null,(function(t,i){if(t)return utils.fail(!0,t,n.cb);e(null,{optionsIn:[{path:["socket","port"],value:i}]})}))},getOnlineStatus:function(n,e){_.isUndefined(n.options.get("online"))&&_.isUndefined(process.env.TESTING)?require("dns").resolve("www.google.com",(function(t){var i=!1;t?n.debug("Could not resolve www.google.com, setting {magenta:online: false}"):(n.debug("Resolved www.google.com, setting {magenta:online: true}"),i=!0),e(null,{options:{online:i}})})):e()},resolveInlineUserPlugins:function(n,e){n.options.get("plugins").map(pluginUtils.resolvePlugin).map(pluginUtils.requirePlugin).forEach((function(e){if(e.get("errors").size)return function(e){utils.fail(!0,e.getIn(["errors",0]),n.cb)}(e);var t=e.toJS();t.options=t.options||{},t.options.moduleName=t.moduleName,n.registerPlugin(t.module,t.options)})),e()},setOptions:function(n,e){e(null,{options:{urls:utils.getUrlOptions(n.options),snippet:!!connectUtils.enabled(n.options)&&connectUtils.scriptTags(n.options),scriptPaths:Immutable.fromJS(connectUtils.clientScript(n.options,!0)),files:n.pluginManager.hook("files:watch",n.options.get("files"),n.pluginManager.pluginOptions)}})},setInternalEvents:function(n,e){require("./internal-events")(n),e()},setFileWatchers:function(n,e){e(null,{instance:{watchers:n.pluginManager.get("file:watcher")(n)}})},mergeMiddlewares:function(n,e){e(null,{options:{middleware:n.pluginManager.hook("server:middleware",n.options.get("middleware"))}})},startServer:function(n,e){var t=n.pluginManager.get("server")(n);e(null,{instance:{server:t.server,app:t.app}})},startTunnel:function(n,e){n.options.get("tunnel")&&n.options.get("online")?require("./tunnel")(n,(function(n,t){return n?e(n):e(null,{optionsIn:[{path:["urls","tunnel"],value:t.url}],instance:{tunnel:t}})})):e()},startSockets:function(n,e){var t=n.pluginManager.hook("client:events",n.options.get("clientEvents").toJS());e(null,{instance:{io:n.pluginManager.get("socket")(n.server,t,n)},options:{clientEvents:Immutable.fromJS(t)}})},startUi:function(n,e){var t="UI",i=n.getUserPlugins(),o=n.pluginManager.get(t),s=n.options.get("ui");if(!s||!1===s.get("enabled"))return e();i.some((function(n){return n.name===t}))&&(s=n.options.get("ui").mergeDeep(Immutable.fromJS(n.pluginManager.pluginOptions.UI)));const r=s.update((e=>{const t=n.options.get("listen");return t?e.set("listen",t):e}));return o(r.toJS(),n,(function(n,t){if(n)return e(n);e(null,{instance:{ui:t}})}))},mergeUiSettings:function(n,e){if(!n.ui)return e();e(null,{options:{urls:n.options.get("urls").merge(n.ui.options.get("urls"))}})},initUserPlugins:function(n,e){n.pluginManager.initUserPlugins(n),e(null,{options:{userPlugins:n.getUserPlugins()}})}};
//# sourceMappingURL=/sm/d9203a2bfc17272a3b165eca62f09ce7502baf8d26f31a68a07d597545f9832f.map
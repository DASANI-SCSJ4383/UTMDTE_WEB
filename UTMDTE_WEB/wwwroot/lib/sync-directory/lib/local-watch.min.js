/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/sync-directory@4.0.12/lib/local-watch.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const fs=require("fs"),path=require("path"),fse=require("fs-extra"),chokidar=require("chokidar"),excludeUtil=require("./exclude"),isDirectoryUtil=require("./is-directory"),{ignoredSymlinkDirs:ignoredSymlinkDirs}=require("./config"),copyFileOrFolder=({srcPath:e,srcDir:r,targetDir:t,exclude:c,forceSync:i,type:a,stayHardlink:n})=>{const s=e.substring(r.length),o=path.join(t,s),y=isDirectoryUtil(e),l=`${s}${y?"/":""}`;if(i(l)||!excludeUtil.test(l,c))try{y?fse.copySync(e,o,{overwrite:!0}):"hardlink"===a?n||(fse.removeSync(o),fse.copySync(e,o,{overwrite:!0})):fse.copySync(e,o,{overwrite:!0})}catch(e){}},removeFileOrFolder=({srcPath:e,srcDir:r,targetDir:t,exclude:c,forceSync:i})=>{const a=e.substring(r.length),n=path.join(t,a),s=`${a}${isDirectoryUtil(e)?"/":""}`;if((i(s)||!excludeUtil.test(s,c))&&n&&fs.existsSync(n))try{fse.removeSync(n)}catch(e){}},processor=(e,r,{type:t,stayHardlink:c,exclude:i,forceSync:a,afterSync:n,deleteOrphaned:s,onError:o,chokidarWatchOptions:y})=>{const l=Object.assign({persistent:!0,alwaysStat:!0,ignored:i},y),d=chokidar.watch(e,l);return d.on("ready",(()=>{const s=async({srcPath:t,eventType:c,nodeType:s,actor:y})=>{if((r=>{const t=`${r.substring(e.length)}${isDirectoryUtil(r)?"/":""}`;return!a(t)&&!!excludeUtil.test(t,i)})(t))return;if(excludeUtil.test(t,ignoredSymlinkDirs))return;const l=t.replace(e,""),d=path.join(r,l);try{await y(),await n({eventType:c,nodeType:s,relativePath:t.replace(e,""),srcPath:t,targetPath:d})}catch(e){await o(e)}};d.on("add",(async n=>{await s({srcPath:n,eventType:"add",nodeType:"file",async actor(){await copyFileOrFolder({srcPath:n,srcDir:e,targetDir:r,exclude:i,forceSync:a,type:t,stayHardlink:c})}})})),d.on("addDir",(async n=>{await s({srcPath:n,eventType:"addDir",nodeType:"dir",async actor(){await copyFileOrFolder({srcPath:n,srcDir:e,targetDir:r,exclude:i,forceSync:a,type:t,stayHardlink:c})}})})),d.on("change",(async n=>{await s({srcPath:n,eventType:"change",nodeType:"file",async actor(){await copyFileOrFolder({srcPath:n,srcDir:e,targetDir:r,exclude:i,forceSync:a,type:t,stayHardlink:c})}})})),d.on("unlink",(async t=>{await s({srcPath:t,eventType:"unlink",nodeType:"file",async actor(){removeFileOrFolder({srcPath:t,srcDir:e,targetDir:r,exclude:i,forceSync:a})}})})),d.on("unlinkDir",(async t=>{await s({srcPath:t,eventType:"unlinkDir",nodeType:"dir",async actor(){removeFileOrFolder({srcPath:t,srcDir:e,targetDir:r,exclude:i,forceSync:a})}})}))})),d};module.exports=processor;
//# sourceMappingURL=/sm/653c0369c2ec08133da81a711d58c773b27a38f6e81d260eef5f59a6d5f7694d.map